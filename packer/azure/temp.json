{"variables":{"client_id":"","client_secret":"","tenant_id":"","subscription_id":""},"sensitive-variables":["client_secret","client_id","tenant_id","subscription_id"],"builders":[{"type":"azure-arm","client_id":"{{ user `client_id` }}","client_secret":"{{ user `client_secret` }}","tenant_id":"{{ user `tenant_id` }}","subscription_id":"{{ user `subscription_id` }}","managed_image_resource_group_name":"rg-packer","managed_image_name":"myWindowsServerImage","os_type":"Windows","image_publisher":"MicrosoftWindowsServer","image_offer":"WindowsServerSemiAnnual","image_sku":"Datacenter-Core-1803-with-Containers-smalldisk","communicator":"winrm","winrm_use_ssl":true,"winrm_insecure":true,"winrm_timeout":"5m","winrm_username":"packer","azure_tags":{"dept":"TestDept","task":"Image deployment"},"location":"West Europe","vm_size":"Standard_B1ms"}],"provisioners":[{"type":"powershell","inline":["Add-WindowsFeature Web-Server","& $env:SystemRoot\\System32\\Sysprep\\Sysprep.exe /oobe /generalize /quiet /quit","while($true) { $imageState = Get-ItemProperty HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Setup\\State | Select ImageState; if($imageState.ImageState -ne 'IMAGE_STATE_GENERALIZE_RESEAL_TO_OOBE') { Write-Output $imageState.ImageState; Start-Sleep -s 10  } else { break } }"]}]}
